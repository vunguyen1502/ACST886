## ------------------------------------------------------------------------
Q2=data.frame("Age-group"=c("40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85-89","90-94"),
              "Exposed to Risk"=c(15518,19428,21594,21890,19174,15775,11414,6993,3276,1096,201),
              "Actual deaths"=c(65,144,219,378,465,557,685,644,471,217,67),
              "Expected deaths"=c(73.9,134.6,223.9,346.3,468.1,600.2,675.5,637.4,458.7,240.6,61.4))
Q2


## ------------------------------------------------------------------------
Ex=Q2$Exposed.to.Risk
dx=Q2$Actual.deaths
E=Q2$Expected.deaths
qx=E/Ex


## ------------------------------------------------------------------------
z=(dx-qx*Ex)/sqrt(Ex*qx*(1-qx))
sum(z^2)


## ------------------------------------------------------------------------
qchisq(0.95,11)
qchisq(0.95,10)
qchisq(0.95,9)
qchisq(0.95,8)
qchisq(0.95,7)



## ------------------------------------------------------------------------
A=c(length(z[z<(-3)]),
    length(z[z<(-2)&z>(-3)]),
    length(z[z<(-1)&z>(-2)]),
    length(z[z<0&z>(-1)]),
    length(z[z<1&z>0]),
    length(z[z<2&z>1]),
    length(z[z<3&z>2]),
    length(z[z>3]))
A


## ------------------------------------------------------------------------
E=11*c(0,0.02,0.14,0.34,0.34,0.14,0.02,0)
E


## ------------------------------------------------------------------------
E=E[c(2:7)]
A=A[c(2:7)]
sum(((E-A)^2)/E)


## ------------------------------------------------------------------------
qchisq(0.95,5)


## ------------------------------------------------------------------------
length(z[z<(2/3)&z>(-2/3)])
length(z[z<0])


## ------------------------------------------------------------------------
sum(dx-Ex*qx)/sqrt(sum(Ex*qx*(1-qx)))


## ------------------------------------------------------------------------
length(z[z>0])


## ------------------------------------------------------------------------
binomk=function(k){
  m=11
  a=c(0:k)
  fac=choose(m,a)
  (sum(fac*(0.5^m))-0.025)
}
v=numeric()
for (i in c(0:11)) {
  v[i+1]=(binomk(i))
}
v


## ------------------------------------------------------------------------
z>0



## ------------------------------------------------------------------------
groupsign=function(k){
  j=c(1:k)
  n1=length(z[z>0])
  n2=length(z[z<0])
  sum((choose(n1-1,j-1)*choose(n2+1,j))/choose(n1+n2,n1))-0.05
}
g=numeric()
for (i in c(1:11)) {
  g[i+1]=(groupsign(i))
}
g


## ------------------------------------------------------------------------
m=11
zi=z[c(1:10)]
zi1=z[c(2:11)]

zb1=sum(zi/(m-1))
zb2=sum(zi1/(m-1))

sqrt(m-1)*sum((zi-zb1)*(zi1-zb2))/sqrt(sum((zi-zb1)^2)*sum((zi1-zb2)^2))



