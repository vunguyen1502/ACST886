## ------------------------------------------------------------------------
ax=c(70:75)
aEx=c(1000,1005,1010,1008,1006,998)
adx=c(80,90,95,105,115,125)


## ------------------------------------------------------------------------
Q5.7=function(u){
  -sum(-aEx*u[1]*(u[2]^ax)+adx*log(aEx*u[1]*(u[2]^ax))-log(factorial(adx)))
}


## ------------------------------------------------------------------------
aiv=c(0.00016,1.09)
options(warn=-1)
u=nlm(Q5.7,aiv)$estimate
u


## ------------------------------------------------------------------------
ux=u[1]*u[2]^ax
data.frame("Age"=ax,"Force of mortality"=ux)


## ------------------------------------------------------------------------
bx=c(30:49)
bEx=c(70000,66672,68375,65420,61779,66091,68514,69560,65000,66279,67300,65368,65391,62917,66537,62302,62145,63856,61097,61110)
bdx=c(39,43,34,31,23,50,48,43,48,47,62,63,84,86,120,121,122,162,151,184)
bcrude=bdx/bEx
lnq=log(bcrude/(1-bcrude))


## ------------------------------------------------------------------------
Q5.8=function(z){
  c=z[1]+z[2]*bx
  sum(bEx*(lnq-c)^2)
}


## ------------------------------------------------------------------------
biv=c(-10,0.09)
z=nlm(Q5.8,biv)$estimate
z


## ------------------------------------------------------------------------
e=exp(z[1]+z[2]*bx)
bqx=e/(e+1)
data.frame("Age"=bx,"Mortality rate"=bqx)


## ------------------------------------------------------------------------
cx=c(47:67)
cEx=c(166,187,218,243,276,302,347,390,430,494,558,628,701,813,917,1040,1182,1299,1432,1596,1752)
cdx=c(2,2,4,6,2,4,7,3,9,9,8,11,14,18,18,24,30,43,41,54,64)
cqx=cdx/cEx
cqsx=c(0.00505,0.00570,0.00644,0.00728,0.00826,0.00930,0.01051,0.01184,0.01331,0.01492,0.01668,0.01859,0.02065,0.02287,0.02525,0.02778,0.03049,0.03339,0.03648,0.03978,0.04332)



## ------------------------------------------------------------------------
Q5.9=function(r){
  qs=r[1]+r[2]*cqsx
  sum(cEx*(cqx-qs)^2)
}


## ------------------------------------------------------------------------
civ=c(0.007,0.6)
r=nlm(Q5.9,civ)$estimate
r


## ------------------------------------------------------------------------
qs=r[1]+r[2]*cqsx
data.frame("Age"=cx,"Mortality rate"=qs)

